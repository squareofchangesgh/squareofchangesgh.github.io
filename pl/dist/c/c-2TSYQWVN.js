import{d as b,e as j}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-OKZSTQSX.js";import{a as _,b as V}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-L26XEBE2.js";import{a as S,b as F}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-YIBTG3FD.js";import{d as M,e as I}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-42SFA7ZB.js";import{Ea as C,Fa as R,q as y,v as B}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-PEYC24KP.js";import{a as $,b as O}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-7JDZLQQ4.js";import{a as p,b as T}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-JWQSDUFI.js";import{r as w,s as D}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-42TSFLLH.js";import{a as A}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-JTEJSVZP.js";import{b as z}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-GJYOXBH4.js";import{a as P}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-3SFTLRL3.js";import{b as W}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-W2OJRSJR.js";import{d as x}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TZYDFHR2.js";var v=x(P()),L=x(A()),g=x(W());F();var E={"template-viewer-widget":S`
	<div class="rmwidget" data-id="<%-id%>"></div>
`};V();R();T();j();O();D();B();z();var U=i=>{let t;switch(i){case"Drag/WidgetRendered":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-BAECRVLH.js");break;case"Drag/PointerDown":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-AZIL42RO.js");break;case"Drag/PointerUp":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-NO4B2AUH.js");break;case"Drag/PointerMove":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-56HIPRFX.js");break;case"Drag/DragStart":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-LXEZ6NL3.js");break;case"Drag/TouchEnd":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-RNAYAZR2.js");break;case"Cursor/WidgetRendered":t=import("https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-4OVI4OCS.js");break;default:t=new Promise((e,s)=>s(new Error("try get unknown handler")))}return t},H=U;I();var G=1,N=L.default.View.extend({template:E["template-viewer-widget"],currentWidgetData:null,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,initialize:function(i,t,e){return g.default.bindAll(this),g.default.extend(this,L.default.Events),this.updateWidgetData(i,t,e),this.initStaticModifiers(),t.getPageViewport()!=="default"&&this.sticked!=="bottom"&&(this.sticked=void 0),this.destroyed=!1,this.$document=(0,v.default)(document),this._id=this._id||G++,this.initModifiersWithEventHandlers(),this},render:function(){return this.makeBox("some-widget-class"),this.rendered=!0,this.checkLink(),this},redraw:function(){return this.checkLink(),this.redrawShadow(),this},redrawShadow:function({shadow:i=this.shadow,isShadowEnabled:t=this.isShadowEnabled,useTransition:e,transition:s="filter .1s",initialRender:o=!1}={}){t&&i&&window.requestAnimationFrame(()=>{let f=o&&i.fadeOnHover?"ffffff00":i.color,m=["video","iframe"].includes(this.type)?"auto":"filter, scroll-position, contents";this.$el.css({...y({...i,color:f}),willChange:m,transition:e?s:""})})},generateCursorStyle:function(){let i=this.cursor,t="";return i&&(this.cursorUrlIsLambda&&this.cursorImageDimension?t=`-webkit-image-set(url('${i}?w=${Math.round(this.cursorImageDimension/2)}') 1x, url('${i}') 2x), auto`:t=`url('${i}'), auto`),t},updatePage:function(i){let t=this.page;(!t||i&&t.num!==i.num)&&(this.page=i,this.redraw())},canRenderImmediately:function(){return!!this.DO_NOT_WAIT_FOR_PRELOAD},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.started&&this.start(),this.trigger("loaded"))},isValid:function(){return!0},hasFontsToLoad:function(){return!1},seamlessFontsShow:function(i,t){if(_.isFastFontLoadCheckAvailable()&&!RM.screenshot&&!this.insideHotspot&&this.hasFontsToLoad()){t();let e=function(){window.requestAnimationFrame(i)},s=function(){i()};this.makeSureFontsLoaded().then(e).catch(s)}},makeSureFontsLoaded:function(){let i=this.page.getFontsVariations([this],!0),t=[];return g.default.each(i,function(e){try{let s=_.fastWaitForFontLoad(e.fontFamily,e.fontWeight,e.fontStyle);t.push(s)}catch(s){console.error("Font checking error",s)}}),window.Promise.all(t)},hasAnimation:function(){return!!this.getAnimations().find(i=>!b.isEmpty(i))},hasLoadAnimation:function(){return!!this.getAnimations().find(i=>i.type==="load")},initStaticModifiers(){this.modifiers?.length&&this.modifiers.forEach(i=>{if(i.static?.length&&i.static.forEach(t=>{t.modelField&&t.value!==void 0&&(this[t.modelField]=t.templateValue?t.templateValue.replace("#fieldValue",t.value):t.value)}),i.id==="cursor"){let t=this.generateCursorStyle();t&&(this.cursorStyle=t)}})},initModifiersWithEventHandlers(){if(this.modifiers?.length){let i={};if(this.modifiers.forEach(t=>{t.events?.length&&t.events.forEach(e=>{let s=H(e.eventHandler);i[e.eventName]||(i[e.eventName]={global:[],isGlobalLoaded:!1,element:[],isElementLoaded:!1}),i[e.eventName][e.isGlobal?"global":"element"].push(s)})}),!g.default.isEmpty(i)){this.modifiersHandlers={};for(let t in i)i[t]&&(this.modifiersHandlers[t]={global:[],element:[]},i[t].element.length?Promise.all(i[t].element).then(e=>{this.modifiersHandlers[t].element=e,i[t].isElementLoaded=!0,this.checkAllHandlersLoadStatus(i)}):(i[t].isElementLoaded=!0,this.checkAllHandlersLoadStatus(i)),i[t].global.length?Promise.all(i[t].global).then(e=>{this.modifiersHandlers[t].global=e,i[t].isGlobalLoaded=!0,this.checkAllHandlersLoadStatus(i)}):(i[t].isGlobalLoaded=!0,this.checkAllHandlersLoadStatus(i)))}}},checkAllHandlersLoadStatus(i){let t=Object.keys(i),e=0,s=0;t.forEach(o=>{s+=1,i[o]?.isElementLoaded&&i[o]?.isGlobalLoaded&&(e+=1)}),s&&e&&e===s&&(this.modifiersHandlersLoaded=!0,this.trigger("modifiers.handlers.loaded"))},addModifierEventListener(i){this[`on${i}`]||(this[`on${i}`]=(t,e)=>{this.modifiersHandlers?.[i]?.[t]?.length&&this.modifiersHandlers[i][t].forEach(s=>{s.default&&s.default({widget:this,e})})})},startModifiersEventListeners(){if(!(!this.modifiersHandlers||this.modifiersEventListenersAdded)){if(!this.rendered){this.once("rendered",()=>this.startModifiersEventListeners());return}this.modifiersEventListenersAdded=!0;for(let i in this.modifiersHandlers){let t=this.modifiersHandlers[i];if(!this[`on${i}`]&&(t?.element?.length||t?.global?.length)&&this.addModifierEventListener(i),t?.element?.length)switch(i){case"rendered":this[`on${i}`]("element");break;default:this.$el[0]?.addEventListener(i,this[`on${i}`].bind(this,"element"))}if(t?.global?.length)switch(i){case"pointermove":this.mag.globalEvents?.on({id:this._id,eventHandler:this[`on${i}`].bind(this,"global")});break;default:window.addEventListener(i,this[`on${i}`].bind(this,"global"))}}}},stopModifiersEventListeners(){if(!(!this.modifiersHandlers||!this.modifiersEventListenersAdded)){this.modifiersEventListenersAdded=!1;for(let i in this.modifiersHandlers){let t=this.modifiersHandlers[i];if(t?.element?.length&&this.$el[0]?.removeEventListener(i,this[`on${i}`]),t?.global?.length)switch(i){case"pointermove":this.mag.globalEvents?.off({id:this._id,eventHandler:this[`on${i}`]});break;default:window.removeEventListener(i,this[`on${i}`])}}}},start:function(){return this.started=!0,this.modifiersHandlersLoaded?this.startModifiersEventListeners():this.once("modifiers.handlers.loaded",()=>this.startModifiersEventListeners()),this},stop:function(){return this.started=!1,this.modifiersHandlersLoaded?this.stopModifiersEventListeners():this.once("modifiers.handlers.loaded",()=>this.stopModifiersEventListeners()),this},hide:function(){return this.stop(),this.$el.hide(),this.wasHidden=!0,this.trigger("hidden"),this},show:function(){return this.$el.show(),this.start(),this.wasHidden=!1,this.trigger("shown"),this},destroy:function(){return this.stop(),this.destroyed=!0,this.trigger("destroyed"),delete this.animationObj,this.$el.off(),this.remove()},softBringToTopZ(){let t=(this.is_above?this.mag.aboveGlobalWidgets:this.page.widgets)?.reduce((s,o)=>o.z&&o.z>s?o.z:s,this.z),e=this.z===t?this.z:t+1;return this.animationObj?this.animationObj.getAnimationContainer().css("z-index",e):this.$el.css("z-index",e),Number(e)},makeBox:function(i){this.setElement(this.template({id:this._id}));let t=this.fixed_position?this.$fixedContainer:this.$pageContainer;this.animationObj&&(t=this.animationObj.getAnimationContainer()),this.$el.appendTo(t).addClass(i).toggleClass("full-width",!!this.is_full_width).toggleClass("full-height",!!this.is_full_height).toggleClass("inside-hotspot",!!this.insideHotspot).toggleClass("use-free-position",!!this.useFreePosition),this.applyBoxStyle({onFirstRender:!0}),this.redrawShadow({initialRender:!0}),(this.is_full_width||this.is_full_height||this.fixed_position||this.sticked)&&this.listenTo(this.page,"resize",this.onPageResize),this.trigger("rendered")},onPageResize:function(){this.applyBoxStyle()},calcBoxStyle:function(i){i=i||{};let t={left:this.x,top:this.y,width:this.w,height:this.h,right:"",bottom:"","margin-left":"","margin-top":"","z-index":this.z||1},e=this.page.mag.getContainerSizeCached(),s=parseInt(this.full_width_margin,10)||0,o=parseInt(this.full_height_margin,10)||0,f=parseInt(this.sticked_margin,10)||0,n=this.page.scale,m=e.width,d=m-e.windowClientWidth,a=this.fixed_position,c,l=this.page.getCachedSizes();if(this.angle&&(t.width=Math.round(this.w),t.height=Math.round(this.h),this.angle%90==0&&t.width%2!==t.height%2&&(t.width+=1)),this.is_full_height&&(t.top=-this.page.contentPosition.top+o,a?(t.top=o/n,t.height=e.windowClientHeight/n-o*2,["nw","w","sw"].indexOf(a)>-1&&(a="nw"),["n","c","s"].indexOf(a)>-1&&(a="n"),["ne","e","se"].indexOf(a)>-1&&(a="ne")):t.height=this.page.pageHeight/n-o*2),this.is_full_width){let h=this.page.mag.getViewportWidth(this.page.pageViewport);if(t.left=-this.page.contentPosition.left+s,t.width=e.width/n-s*2,c=-((t.width-this.page.$content[0].clientWidth)/2).toFixed(3),p.isOn(this.page.pageViewport,h,this.mag.viewOpts)&&e.width>this.mag.viewOpts.scalewidth&&(Modernizr.msie11?(c=-(m-this.page.$content[0].clientWidth)/2-d/2,t.left=c/n):Modernizr.firefox?(t.width=t.width+1,t.left=c-1):t.left=c),a){if(t.left=s,this.page.viewerType=="horizontal"){let k=l.scrollWrapperWidth-l.scrollWrapperClientWidth;t.width-=k/n}["nw","n","ne"].indexOf(a)>-1&&(a="nw"),["w","c","e"].indexOf(a)>-1&&(a="w"),["sw","s","se"].indexOf(a)>-1&&(a="sw")}}if(this.sticked){let h=0;this.page.viewerType=="horizontal"&&(h=l.scrollWrapperWidth-l.scrollWrapperClientWidth),this.sticked=="left"&&(t.left=-this.page.contentPosition.left/n+f),this.sticked=="right"&&(t.left=this.page.mag.getContainerSizeCached().width/n-f-this.w-this.page.contentPosition.left/n-h/n),this.sticked=="top"&&(t.top=-this.page.contentPosition.top/n+f),this.sticked=="bottom"&&(t.top=l.contentContainerHeight-f-this.h+this.page.contentPosition.top/n)}if(i.calcBBox){a&&(t.left*=n,t.top*=n,t.width*=n,t.height*=n),t.sinAngle=Math.sin(-(this.angle||0)*Math.PI/180),t.cosAngle=Math.cos(-(this.angle||0)*Math.PI/180);let h=$.calcBoundingBox(t,a);return t.width=h.bb_width,t.height=h.bb_height,t.left=h.bb_left,t.top=h.bb_top,a&&g.default.extend(t,w.getFixedPositionCSS(a,t,1)),{dimensions:t}}if(a){let h=this.page.mag.getViewportWidth(this.page.pageViewport);g.default.extend(t,w.getFixedPositionCSS(a,t,p.normalize(n,"transform",this.page.pageViewport,h,this.mag.viewOpts))),p.isOn(this.page.pageViewport,h,this.mag.viewOpts)&&p.isCSSZoom()&&(t.zoom=n)}let r={rotate:this.angle?this.angle+"deg":"",scaleX:this.flip_h?-1:1,scaleY:this.flip_v?-1:1};if(a){let h=this.page.mag.getViewportWidth(this.page.pageViewport),k=p.normalize(n,"transform",this.page.pageViewport,h,this.mag.viewOpts);r.scaleX*=k,r.scaleY*=k}if(Math.abs(r.scaleX-1)<1e-6&&(r.scaleX=""),Math.abs(r.scaleY-1)<1e-6&&(r.scaleY=""),this.isDraggable&&this.$el){let h=w.getElementTranslateByString(this.$el[0]);(h.x||h.y)&&(r.translate=`${h.x}px, ${h.y}px`)}let u={};return this.cursorStyle&&(u.cursor=this.cursorStyle),{dimensions:t,decorations:u,transform:r}},applyBoxStyle:function(i){if(this.isDragging)return;let t=this.calcBoxStyle();this.isDraggable&&!i?.onFirstRender&&delete t.dimensions["z-index"],this.animationObj&&(t=this.animationObj.modifyWidgetPosition(t)),this.$el.css(t.dimensions),g.default.isEmpty(t.decorations)||this.$el.css(t.decorations);let e=g.default.map(t.transform,function(s,o){return s?o+"("+s+")":""}).join(" ");w.applyTransform(this.$el,v.default.trim(e))},calcDistsToPageVisibleBounds:function(){let i,t=this.page.mag.getContainerSizeCached(),e=p.isOnForRatio(this.page.pageViewport,this.page.scale,this.mag.viewOpts)&&p.isCSSZoom()?p.getBox(this.$el[0],this.page.scale):this.$el[0].getBoundingClientRect(),s=this.page.mag.isPreview?this.page.mag.$mag_container[0].getBoundingClientRect():{top:0,left:0},o=(e.top+e.height/2-s.top)/this.page.scale,f=(t.height-(e.top+e.height/2-s.top))/this.page.scale,n=(e.left+e.width/2-s.left)/this.page.scale,m=(t.width-(e.left+e.width/2-s.left))/this.page.scale;if(this.fixed_position){let c=this.page.$el[0].getBoundingClientRect();var d=(e.top+e.height/2-c.top)/this.page.scale,a=(c.height-(e.top+e.height/2-c.top))/this.page.scale;i={left:Math.max(0,n),right:Math.max(0,m),top:Math.max(0,Math.min(o,d)),bottom:Math.max(0,Math.min(f,a))}}else{let c=this.page.contentPosition.left/this.page.scale,l=this.page.contentPosition.top/this.page.scale,r=this.x+this.w/2,u=this.y+this.h/2;var d=u+l,a=this.page.contentHeight-u+l;i={left:Math.max(0,r+c),right:Math.max(0,this.page.pageWidth-r+c),top:Math.max(0,Math.min(o,d)),bottom:Math.max(0,Math.min(f,a))}}return i},checkLink:function(){let i={};if(!this.clickLink||!M(this))return;this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);let t=/^(.*):\/\/[^\s$.?#].[^\s]*$/i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),e=/^__rm_goback$/i.test(this.clickLink),s=this.mailchimpMatcher.test(this.clickLink),o=this.anchorRegexp.test(this.clickLink),f=this.shareRegexp.test(this.clickLink);var n=this.clickLink,m=C(this.clickTarget,this.clickLink),d=t?"external-link":e?"goback-link":"maglink";if(s&&(d="mailchimp-link"),o&&(d="anchor-link"),f&&(d="share-link"),!t){let r=n;/^back\sto\stop$/i.test(n)&&(r=this.page._id);var a=this.page.mag.getPageNum(r),n=a&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(r):"javascript:void(0)";a||(n=""),r==this.page._id&&(d+=" back-to-top",this.is_global&&(d+=" current"))}if(e&&(n="javascript:void(0)"),s){n="javascript:void(0)";let r=this.clickLink.match(this.mailchimpMatcher)[1];i["data-mailchimp"]=r}if(o){n="javascript:void(0)",i["data-anchor-link-pos"]=this.anchor_link_pos;let r=g.default.findWhere(this.mag.pages,{_id:this.clickPage})||this.page;i["data-page-uri"]=r.uri||r.num}if(f){n="javascript:void(0)";let r=this.clickLink.match(this.shareRegexp);i["data-share-provider"]=r[1],i["data-share-type"]=r[2]}if((n.indexOf("mailto")==0||n.indexOf("tel")==0)&&(m=""),!n)return;(this.insideHotspot?typeof this.closeTip=="boolean"?this.closeTip:!0:!1)&&(d+=" close-tip-on-click"),g.default.extend(i,{class:d,href:n,target:m});let l=this.$el.parent("a");l.length?l.attr(i):(l=(0,v.default)("<a>").attr(i),this.$el.wrap(l)),!t&&RM.screenshot&&(l=this.$el.parent("a"),l.removeAttr("href"))},updateWidgetData:function(i,t,e){g.default.extend(this,i,i.params),this.page=t,this.mag=this.page.mag,this.$pageContainer=e||this.page.$content,this.x=this.x||0,this.y=this.y||0;let s=null;this.is_global?this.is_above?s=t?.mag?.aboveGlobalWidgetsData?.find(o=>o._id===this._id):s=t?.mag?.staticGlobalWidgetsData?.find(o=>o._id===this._id):t?.widgetsData&&(s=t.widgetsData?.find(o=>o._id===this._id)),this.currentWidgetData=s||g.default.extend({},i,i.params)},getAnimations(){return b.normalizeAnimations(this.animation)},getAnimationTriggers:function(i){let t=this.getAnimations().find(e=>e.UUID===i);return b.normalizeAnimationTriggers(t&&t.trigger)},isGlobal:function(){return!!this.is_global},isAbove:function(){return!!this.is_above}}),ht=N;export{ht as a};
