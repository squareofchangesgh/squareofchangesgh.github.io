import{a as me,b as He}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-OK62EUXB.js";import{a as w,b as pe,c as fe,e as De}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-42SFA7ZB.js";import{a as de,b as Be}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SHXN2MUC.js";import{e as le,f as Le,g as he,i as Ue}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-QTI3PI5F.js";import{a as ce,b as ze}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-5SLUZRMW.js";import{d as K,g as ke,j as $,l as Q,m as F,n as ee,p as te,q as ie,r as re,s as oe,t as ne,u as Ce}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-22ZYTENX.js";import{a as G,b as Ie}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-7JDZLQQ4.js";import{a as b,b as ue}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-B44ZIHQO.js";import{d as O,e as se,g as ae}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SUQN7X7E.js";import{l as J,m as Me}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-OEU46UX3.js";import{c as M,d as k,e as C,o as Oe,q as L,r as Ee}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-VRF7LILE.js";import{D as U,b as z,l as B,r as S,v as D,x as H}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-M4TEEAX7.js";import{b as N,c as Re}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SXBIDYQQ.js";import{a as q,h as X,j as Y,k as g,l as Z}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-PR2DJXFR.js";import{b as j}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-GJYOXBH4.js";import{a as x,b as I}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-KGGRYMSL.js";import{a as h,f as a}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TZYDFHR2.js";var ge=h(()=>{"use strict"});var _,V,E,be=h(()=>{"use strict";Be();ze();I();Ee();_=class _{constructor(){a(this,"observer",null);a(this,"observedElements",new Map);a(this,"handleResize",r=>{for(let e of r){let i=this.observedElements.get(e.target);if(i){let{top:o,left:n,width:l,height:u}=L.getDocumentBox(e.target);i({top:o,left:n,width:l,height:u})}}});ce(this),!x()&&(this.observer=new de(this.handleResize))}observe(r,e){this.observedElements.set(r,e),this.observer?.observe(r)}unobserve(r){this.observedElements.delete(r),this.observer?.unobserve(r)}static getInstance(){return this._instance||(this._instance=new _),this._instance}};a(_,"_instance",null);V=_,E={observe(t,r){V.getInstance().observe(t,r)},unobserve(t){V.getInstance().unobserve(t)}}});var v,ye=h(()=>{"use strict";pe();Oe();be();v=class extends w{constructor(){super();a(this,"ref",null);a(this,"offset",{top:0,left:0,width:0,height:0});a(this,"rect",{top:0,left:0,width:0,height:0});this.initStore()}setElement(e){if(e===null||this.ref===e)return;let i=this.ref;i&&E.unobserve(i),this.setState({ref:e}),this.ref&&(this.setState({offset:this.calculateOffsets(),rect:C(e)}),E.observe(this.ref,o=>{this.setState({offset:this.calculateOffsets(),rect:o})}))}calculateOffsets(){return this.ref?{width:this.ref.offsetWidth,height:this.ref.offsetHeight,top:M(this.ref),left:k(this.ref)}:{width:0,height:0,top:0,left:0}}}});var W,T,A,xe=h(()=>{"use strict";I();ae();W=class W{constructor(){a(this,"store",new Map);a(this,"primaryObserver",null);a(this,"secondaryObserver",null);a(this,"primaryObserverMargin",0);a(this,"secondaryObserverMargin",0);a(this,"rootObserver",null);a(this,"threshold",Array.from({length:100},(r,e)=>e/100));a(this,"entriesLoop",(r,e,i)=>{for(let o of r){let n=this.store.get(o.target);if(n){let l=!1;(o.isIntersecting||o.intersectionRatio>0)&&e(n.state)&&(l=!0),o.intersectionRatio<=0&&i(n.state)&&(l=!0),l&&n.listener({...n.state})}}});a(this,"handlePrimaryVisibility",r=>{this.entriesLoop(r,e=>e.isVisible?!1:(e.isVisible=!0,e.wasVisible=!0,!0),e=>e.isVisible?(e.isVisible=!1,!0):!1)});a(this,"handleSecondaryVisibility",r=>{this.entriesLoop(r,e=>e.aboutToShow?!1:(e.wasVisible=!0,e.aboutToShow=!0,!0),e=>e.aboutToShow?(e.aboutToShow=!1,!0):!1)});x()||(this.primaryObserver=new IntersectionObserver(this.handlePrimaryVisibility,{root:this.rootObserver,rootMargin:O(this.primaryObserverMargin),threshold:this.threshold}),this.secondaryObserverMargin=x()?0:window.innerHeight,this.secondaryObserver=new IntersectionObserver(this.handleSecondaryVisibility,{root:this.rootObserver,rootMargin:O(this.secondaryObserverMargin),threshold:this.threshold}))}observe(r,e=!1,i){let o={isVisible:e,wasVisible:e,aboutToShow:e};return this.store.set(r,{listener:i,state:o}),this.primaryObserver?.observe(r),this.secondaryObserver?.observe(r),o}unobserve(r){this.store.delete(r),this.primaryObserver?.unobserve(r),this.secondaryObserver?.unobserve(r)}static getInstance(){return this._instance||(this._instance=new W),this._instance}};a(W,"_instance",null);T=W,A={observe(t,r,e){return T.getInstance().observe(t,r,e)},observeMultiple(t,r,e){let i=()=>{e({isVisible:o.some(n=>n.isVisible),wasVisible:o.some(n=>n.wasVisible),aboutToShow:o.some(n=>n.aboutToShow)})},o=t.map(n=>A.observe(n,r,i))},unobserve(t){let r=T.getInstance(),e=Array.isArray(t)?t:[t];for(let i of e)r.unobserve(i)}}});function y(t){switch(t){case"phone_portrait":return"viewport_phone_portrait";case"tablet_portrait":return"viewport_tablet_portrait";default:return"viewport_default"}}function je(t,r){let e=y(r);if(e!=="viewport_default"){let i=t[e];if(i&&Object.keys(i).length>0)return t[e]}return t}function bt(t,r){let e=je(t,r);return e&&e.height?e.height:t.height}var we=h(()=>{"use strict"});var ve=h(()=>{"use strict"});function It(t){if(typeof t=="number"&&t!==0){let r=Math.PI/180*t;return{angle:t,radians:r,cos:Math.cos(r),sin:Math.sin(r)}}return null}function Ne({rotation:t,point:r,origin:e}){if(!t||S(t))return r;let{cos:i,sin:o}=t;if(e){let u={x:e.left+e.width/2,y:e.top+e.height/2},d=u.x+(r.x-u.x)*i-(r.y-u.y)*o,p=u.y+(r.x-u.x)*o+(r.y-u.y)*i;return{x:d,y:p}}let n=i*r.x+o*r.y,l=i*r.y-o*r.x;return{x:n,y:l}}function Se(t){return typeof t=="string"?t:t===!0?"swing":null}function Mt(t){let r=t.loop||(t.steps.length?t.steps[0].loop:void 0);if(r){let e=Se(r);if(e)return{startIndex:0,value:e}}else{let e=t.steps.findIndex((i,o)=>o!==0&&i.loop);if(e>-1){let i=t.steps[e],o=Se(i?.loop);if(i&&o)return{startIndex:e,value:o}}}return null}function kt(t){return t?.steps.length&&t.steps[0].startWhenInView||!1}function qe(t){return!t||S(t)||S(t.steps)||!t.type||t.type==="none"}function Ve(t,r){let e=t.animation,i=e&&!Array.isArray(e)?[e]:e||[];if(!i?.length)return;let o=!!t.fixed_position,n=t.is_full_width,l=t.is_full_height,u=!o&&!n&&!l,d=[];for(let p of i){if(qe(p))continue;let f=b(p);if(u||(f.UUID=Je(JSON.stringify(f))),f.trigger){let m=f.trigger;f.trigger=m&&!Array.isArray(m)?[m]:m||[],r&&r.length>0&&f.trigger&&(f.trigger=f.trigger.filter(s=>r.includes(s)))}let P=[],c={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100};for(let m=0;m<f.steps.length;m++){let s=b(f.steps[m]);(!s.use_bezier||s.use_bezier&&!s.curve)&&(s.curve={}),s.curve&&!s.curve.c1&&(s.curve.c1={x:c.dx??0,y:c.dy??0}),s.use_move?(c.dx=s.dx,c.dy=s.dy):(s.dx=c.dx,s.dy=c.dy),s.curve&&!s.curve.c2&&(s.curve.c2={x:s.dx??0,y:s.dy??0}),s.use_opacity?(c.from_opacity=s.from_opacity,c.opacity=s.opacity):(s.from_opacity=c.from_opacity,s.opacity=c.opacity),s.use_scale?(c.from_scale=s.from_scale,c.scale=s.scale):(s.from_scale=c.from_scale,s.scale=c.scale),s.use_rotate?(c.from_rotate=s.from_rotate,c.rotate=s.rotate):(s.from_rotate=c.from_rotate,s.rotate=c.rotate),n&&(s.dx=0,s.rotate=0,s.from_rotate=0),l&&(s.dy=0,s.rotate=0,s.from_rotate=0),f.type==="scroll"&&!o&&m===0&&(s.delay_px=0),m!==0&&(delete s.from_opacity,delete s.from_rotate,delete s.from_scale),P.push(s)}P.length&&d.push({...f,steps:P})}if(d.length)return Xe(d)}function R(t,r){let e={...t};if(r.rotation?.angle!==0){let{x:i,y:o}=Ne({rotation:r.rotation,point:{x:t.x??0,y:t.y??0}});e.x=i,e.y=o}return r.flipX&&e.x!==0&&(e.x*=-1),r.flipY&&e.y!==0&&(e.y*=-1),e}function Ct(t,r){let e=[];for(let i of t.steps){let o={...i},{x:n,y:l}=R({x:o.dx??0,y:o.dy??0},r);o.dx=n,o.dy=l,typeof o.from_rotate=="number"&&o.from_rotate!==0&&(r.flipX&&(o.from_rotate*=-1),r.flipY&&(o.from_rotate*=-1)),typeof o.rotate=="number"&&o.rotate!==0&&(r.flipX&&(o.rotate*=-1),r.flipY&&(o.rotate*=-1)),o.curve={c1:R(i.curve.c1,r),c2:R(i.curve.c2,r)},e.push(o)}return{...t,steps:e}}function Xe(t){let r=["click","hover","scroll","load","moveOnly","nonMove"];function e(i){return i.steps?.every(o=>o.use_move&&!o.use_scale&&!o.use_rotate)?"moveOnly":i.steps?.every(o=>!o.use_move)?"nonMove":i.type}return t.sort((i,o)=>r.indexOf(e(i))-r.indexOf(e(o))),t.sort((i,o)=>i.steps?.some(n=>n.opacity===0&&n.use_opacity)&&!o.steps?.some(n=>n.opacity===0&&n.use_opacity)?-1:0),t}function Lt(t){return t?.length?t.some(r=>r.type==="click"):!1}function zt(t){return t?.length?t.some(r=>r.type==="hover"):!1}function Bt(t){return t?.length?t.some(r=>r.type==="scroll"):!1}function Dt(t){return t?.length?t.some(r=>r.steps?.some(e=>e.use_rotate||e.use_move||e.use_scale)):!1}function Ht(t){return t?.length?t.some(r=>r.steps?.some(e=>e.use_opacity)):!1}function Ye(t=[]){return!!t.find((e,i)=>e.use_rotate&&(i===0&&e.from_rotate!==0||e.rotate!==0))}function Ze(t=[]){return!!t.find((e,i)=>e.use_scale&&(i===0&&e.from_scale!==100||e.scale!==100))}function Ut(t=[]){let r=K()?J().animationType==="bezier":!0,e=typeof window<"u"?window.CSS.supports('(offset-path: path("M 0,0")) and (offset-rotate: 0deg) and (offset-distance: 1px)'):!0,i=Ge();return!r||!e?!1:i?!Ye(t)&&!Ze(t):!0}function jt(t,r){let e={};return r==="from"?(t.use_move&&(e.x=0,e.y=0),t.use_rotate&&typeof t.from_rotate=="number"&&(e.rotate=t.from_rotate),t.use_scale&&typeof t.from_scale=="number"&&(e.scale=t.from_scale/100),t.use_opacity&&typeof t.from_opacity=="number"&&(e.opacity=t.from_opacity/100)):(t.use_move&&(typeof t.dy=="number"&&(e.y=t.dy),typeof t.dx=="number"&&(e.x=t.dx)),t.use_rotate&&typeof t.rotate=="number"&&(e.rotate=t.rotate),t.use_scale&&typeof t.scale=="number"&&(e.scale=t.scale/100),t.use_opacity&&typeof t.opacity=="number"&&(e.opacity=t.opacity/100)),typeof e.opacity!="number"&&(e.opacity=1),typeof e.rotate!="number"&&(e.rotate=0),typeof e.scale!="number"&&(e.scale=1),typeof e.x!="number"&&(e.x=0),typeof e.y!="number"&&(e.y=0),e}function Nt(t,r,e){let i={},o=H(t,e?["scale","rotate"]:["x","y","scale","rotate"]);return Object.keys(o).length&&(i.transform=se(o,!0)),typeof t.opacity=="number"&&(i.opacity=t.opacity,i.opacity===0&&!r?i.visibility="hidden":i.visibility="inherit"),i}function Je(t){let r=0;for(let e=0;e<t.length;e++){let i=t.charCodeAt(e);r=(r<<5)-r+i,r|=0}return String(Math.abs(r))}var Ge,_e=h(()=>{"use strict";j();U();ue();ae();ke();Me();Ge=()=>{let t=typeof window<"u"?window.navigator.userAgent:"";if(/ Safari\//.test(t)&&!/ Chrom/.test(t)){let r=navigator.userAgent.match(/ Version\/(\d+)/)??[];return r[1]?Number(r[1])<=15:!1}else return!1}});function Ke(t,r,e){let i=r[g.globalPrefix+t]||[],o=i.find(n=>n.pid===e)||i.find(n=>n.pid==="default");return!o||o.value===void 0?r[t]:o.value}function Te(t,r,e){let i={},o=e||g.globalKeys;for(let n of o)if(t[`${g.globalPrefix}${n}`]){let l=Ke(n,t,r);typeof l<"u"&&(i[n]=l)}return i}var We=h(()=>{"use strict";Z()});function Vi(t,r=!1){return $e(t,r)}var Ae,Pe,$e,Qe,Si,Fe=h(()=>{"use strict";j();Z();U();ue();ge();pe();ye();xe();De();Le();we();ve();Ce();_e();We();He();Ue();Re();Ie();Ae=99999,Pe=class t extends w{constructor(e){super();this.options=e;a(this,"_model");a(this,"currentViewport");a(this,"model");a(this,"element");a(this,"animationElement");a(this,"visibility");a(this,"link");a(this,"triggersStore");a(this,"animationsStore");a(this,"zIndexStore");a(this,"hasViewports",!1);a(this,"isWidgetTrigger");a(this,"rendered",!1);this.initStore({detachedKeys:["zIndexStore","triggersStore","animationsStore"]}),this._model=this.prepareWidgetData(e.widget,e.pageMeta?.state?.widgetsIds);let i=e.pageMeta?.state.currentViewport||e.project.projectViewport.value;this.setState({triggersStore:e.triggersStore,animationsStore:e.animationsStore,zIndexStore:e.zIndexStore,currentViewport:e.initialViewport||i,model:this._model}),e.disposable||this.setState({element:new v,animationElement:new v}),this.computeWidgetModel();let o=this.getInitialVisibility();this.setState({isWidgetTrigger:this.triggersStore.isWidgetTrigger(this.model._id),visibility:o,rendered:o.isVisible}),e.disposable||(this.bindViewportListener(e.pageMeta),this.bindElementListener(),this.bindTriggersListener()),(!e.initialViewport||e.initialViewport===i)&&this.animationsStore.addWidget({widgetId:this.model._id,animations:this.model.animation||[],rotation:this.model.angle,flipX:!!this.model.flip_h,flipY:!!this.model.flip_v,rect:{width:this.model.is_full_width?this.model.full_width_initial_w||this.model.w:this.model.w,height:this.model.is_full_height?this.model.full_height_initial_h||this.model.h:this.model.h,top:this.model.is_full_height?this.model.full_height_initial_y||this.model.y:this.model.y,left:this.model.is_full_width?this.model.full_width_initial_x||this.model.x:this.model.x}}),this.setState({link:new fe({widget:this,project:e.project})})}bindElementListener(){let e=()=>{let i=[this.element?.ref,this.animationElement?.ref].filter(Boolean);i.length&&A.unobserve(i);let o=i[i.length-1];o&&A.observe(o,this.visibility.isVisible,n=>{let l={visibility:n};n.aboutToShow&&!this.rendered&&(l.rendered=!0),this.setState(l)})};this.element?.subscribe(i=>i.ref,i=>{i&&(e(),this.triggersStore.bindTriggerElement(this.model._id,i))}),this.animationElement?.subscribe(i=>i.offset,i=>{e(),this.animationsStore.updateWidgetRect(this.model._id,i)})}bindTriggersListener(){this.triggersStore.subscribe(()=>{let e=this.triggersStore.isWidgetTrigger(this.model._id);e!==this.isWidgetTrigger&&this.setState({isWidgetTrigger:e})})}addTriggerCallback(e){return this.triggersStore.addTriggerCallback({...e,responderWidgetId:this.model._id})}bindViewportListener(e){e&&(this.setState({currentViewport:e.state.currentViewport}),e.subscribe(i=>i.state.currentViewport,i=>this.setCurrentViewport(i)))}setCurrentViewport(e){this.setState({currentViewport:e}),this.computeWidgetModel()}computeWidgetModel(){let e=this.currentViewport;this.setState({model:this.getViewportData(e),hasViewports:this.calculateHasViewports()})}getViewportData(e){return t.extractViewportData(this._model,e)}setViewportWidgetState(e){let i=this.currentViewport,o=this._model;if(typeof e.z=="number"&&this.zIndexStore.setZIndex(this._model._id,e.z),i==="default")Object.assign(this._model,{...e});else{let n=y(i);Object.assign(this._model,{[n]:{...o[n]||{},...e}})}this.computeWidgetModel()}prepareWidgetData(e,i){let o=b(e);return Y(o,(n,l)=>{let u=t.getWidgetViewportData(o,l,o.pid);if(!n||!u){n===null&&delete o[y(l)];return}for(let d of g.globalKeys)typeof u?.[d]<"u"&&(n[d]=u[d]);"animation"in u&&(n.animation=Ve(u,i)),$(n)&&Object.assign(n,me(n)),ie(n)&&Object.assign(n,{fields:n.fields.filter(d=>d.tp!=="captcha")}),ne(n)&&(n["hover-cursor"]="")}),o}isHiddenInViewport(e=this.currentViewport){let i=this.getViewportData(e);return!!(!i||i.hidden)}hasViewport(e){return t.widgetHasViewport(this._model,e)}calculateHasViewports(){return Object.values(q).some(e=>!this.isHiddenInViewport(e))}moveTo(e){this.setViewportWidgetState(e)}zIndexToTop(){this.setViewportWidgetState({z:this.model.z+Ae})}zIndexResetToNormal(){this.setViewportWidgetState({z:this.model.z-Ae})}setTopmostZIndex(){this.setViewportWidgetState({z:this.zIndexStore.getTopmostZIndex()+1})}getInitialVisibility(){let e={height:2e3,width:2e3,left:0,top:0};if(["background","rmheader"].includes(this.model.type))return{isVisible:!0,wasVisible:!0,aboutToShow:!0};let i=this.model.fixed_position?le.getFixedPositionBox(this.model.fixed_position,{w:this.model.w,h:this.model.h,x:this.model.x,y:this.model.y},1,e):{left:this.model.x,top:this.model.y,right:this.model.x+this.model.w,bottom:this.model.y+this.model.h},o=G.doBoundingBoxesIntersect({left:i.left,bottom:i.bottom??0,right:i.right??0,top:i.top},{left:e.left,bottom:e.top+e.height,right:e.left+e.width,top:e.top});return{isVisible:o,wasVisible:o,aboutToShow:o}}clone(e={}){return new t({...this.options,...e,disposable:!0})}getLockedViewportClone(e){return this.clone({initialViewport:e})}hasLoadAnimation(){return this.model.animation?this.model.animation.some(e=>e.type==="load"):!1}static getWidgetViewportData(e,i,o){let n=b(e);if(re(n)||oe(n))return n;let l=t.extractViewportData(n,i);if(!l)return null;if(n.is_global){let u=Te(l,o);l={...l,...u}}return l}static canUseWidgetForLayerType(e,i){if(!e)return!1;if(e.type==="background"&&i==="fixed"||e.type==="rmheader")return!0;let o=e?.fixed_position&&i==="regular",n=!e?.fixed_position&&i==="fixed";return!o&&!n}static widgetHasViewport(e,i){let o=y(i);return o==="viewport_default"?!0:o in e&&Object.keys(e[o]||{}).length>0}static extractViewportData(e,i){let o=y(i),n=X(e.type,e.version,!1),l=b(e);if(i==="default"||!t.widgetHasViewport(e,i))return l;let u=!N.isModernMinimalViewport&&he(e);for(let p of n)ee(e)&&(p==="borders"||p==="weight"||p==="bg_color")||F(e)&&p==="picture"||Q(e)&&e.version===3&&p==="blocks"||u&&(delete l[p],te(e)&&!e[o][p]&&B(g.viewport_fields.button,g.viewport_fields_common).includes(p)&&(l[p]=e[p]));return z(l,D(e[o],["_id","modelType"]))}},{useStore:$e,Provider:Qe}=w.createContext(),Si=Qe});export{It as a,Ne as b,Mt as c,kt as d,Ct as e,Lt as f,zt as g,Bt as h,Dt as i,Ht as j,Ut as k,jt as l,Nt as m,_e as n,ge as o,v as p,ye as q,A as r,xe as s,y as t,bt as u,we as v,ve as w,Te as x,We as y,Pe as z,Si as A,Vi as B,Fe as C};
