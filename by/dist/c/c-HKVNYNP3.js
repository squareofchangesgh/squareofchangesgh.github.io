import{c as S,d as F}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TW324QB3.js";import{a as L,b as B}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-DQDVK4WP.js";import{a as T}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-CDLDI33S.js";import{a as w,b as E}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-KGGRYMSL.js";import{a as f,d as C,f as i}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TZYDFHR2.js";function y(){if(typeof window>"u")return!1;let m=document.createElement("canvas");if(m.width=1,m.height=1,m.toDataURL&&m.toDataURL("image/webp").indexOf("data:image/webp")==0)return!0;let e=navigator.userAgent.match(/(Edg|Firefox)\/(\d+)\./);if(e)return e[1]==="Firefox"&&e[2]>=65||e[1]==="Edge"&&e[2]>=18;if(e=navigator.userAgent.match(/OS X\s?(?<os>\d+)?.+ Version\/(?<v>\d+\.\d+)/),e){let a=window.Intl||{};return e.groups.v>=14&&((e.groups.os||99)>=11||a.ListFormat!=null)}return!1}var x=f(()=>{"use strict"});var u,q,P,R=f(()=>{"use strict";u=C(T());E();B();x();q=6,P=class{constructor(e,a,t,s,n){this.onAllImagesLoaded=n;i(this,"imageInstances",[]);i(this,"imagesLoaded",0);i(this,"isLoading",!1);i(this,"seekCallbackData");i(this,"areAllImagesLoaded",!1);if(w())return;let l=(0,u.range)(1,a+1).map(r=>this.getImageUrl(e,r,t,s));for(let r of l)this.imageInstances.push({imagePreloader:this.createPreloader(r),isLoaded:!1,url:r})}async preloadFirstImage(){return this.loadImage(0)}async loadImage(e){let a=this.imageInstances[e];if(!a||a.isLoaded)return;let t=await a.imagePreloader.preload();a.imageSource=t,a.isLoaded=!0,this.imagesLoaded++,this.imageInstances.length===this.imagesLoaded&&(this.areAllImagesLoaded=!0,this.isLoading=!1,this.onAllImagesLoaded&&this.onAllImagesLoaded()),this.seekCallbackData&&this.seekCallbackData.index===e&&(this.seekCallbackData.callback(a.imageSource),this.seekCallbackData=void 0)}startLoad(){if(this.isLoading)return;this.areAllImagesLoaded=!1,this.isLoading=!0;let e=[0],a=Math.ceil(Math.log(this.imageInstances.length)/Math.log(2));for(let t=1;t<=a;t++){let s=Math.pow(2,t),n=Math.ceil(this.imageInstances.length/s);for(let l=1;l<=s;l++){let r=l*n;e.push(r)}}e=(0,u.uniq)(e).filter(t=>t<this.imageInstances.length);for(let t of e)this.loadImage(t)}stopLoad(){if(this.isLoading){for(let e of this.imageInstances)e.isLoaded||e.imagePreloader.abort();this.isLoading=!1}}async seekImageByIndex(e){this.seekCallbackData&&(this.seekCallbackData.callback(void 0),this.seekCallbackData=void 0);let a=e;return new Promise(t=>{e>this.imageInstances.length-1&&(a=this.imageInstances.length-1),e<0&&(a=0);let s=this.imageInstances[a];if(s.isLoaded)return t(s.imageSource);this.seekCallbackData={index:a,callback:t}})}getImageIndexByTimelinePercent(e){return Math.floor(this.imageInstances.length*e)}getNumberOfImages(){return this.imageInstances.length}createPreloader(e){let a=new Image;return{async preload(){return new Promise((t,s)=>{a.onerror=s,a.onload=()=>{t(a)},L(()=>{a.src=e})})},abort(){a.onload=null,a.src=""}}}getImageUrl(e,a,t,s){let n=t||(s&&y()?"webp":"jpg");return`${e}/${a.toString().padStart(q,"0")}.${n}?c`}}});var I,b,N,k,_=f(()=>{"use strict";F();I=400,b=16.66,N=Math.floor(I/b),k=class{constructor(e,a,t){i(this,"canvas");i(this,"imageLoader");i(this,"easingType",1);i(this,"lastDrawnFrameIndex");i(this,"easingSequenceId");i(this,"lastEasingCallTime",0);i(this,"lastTargetIndex",0);i(this,"isPlayingAnimation",!1);i(this,"isPaused",!1);i(this,"byStepReverse",!1);this.canvas=e,this.imageLoader=a,this.easingType=t}drawImageByIndex(e,a=!1){return a?this.startEasingSequence(e):this.imageLoader.seekImageByIndex(e).then(t=>this.drawImage(t,e))}drawImageByTimelinePercent(e,a=!1){let t=this.imageLoader.getImageIndexByTimelinePercent(e);return this.drawImageByIndex(t,a)}startDrawingByStep(e,{speed:a,loop:t,spring:s}){let n=o=>o*b/a,r=n(e),d=null;this.isPlayingAnimation=!0;let c=o=>{if(!d&&this.isPaused&&this.lastDrawnFrameIndex){let p=this.byStepReverse?e-this.lastDrawnFrameIndex:this.lastDrawnFrameIndex;d=o-n(p+1),this.isPaused=!1}else d||(d=o);let h=Math.min((o-d)/r,1),g=Math.floor(h*(e-0)+0)/1;this.drawImageByIndex(this.byStepReverse?e-g:g).then(()=>{h===1&&t?(d=o,s&&(this.byStepReverse=!this.byStepReverse)):h===1&&(this.isPlayingAnimation=!1),this.isPlayingAnimation&&window.requestAnimationFrame(c)})};window.requestAnimationFrame(c)}stopDrawingByStep(){this.isPlayingAnimation=!1}pauseDrawingByStep(){this.isPlayingAnimation=!1,this.isPaused=!0}drawImage(e,a){return new Promise((t,s)=>{if(!e||a===this.lastDrawnFrameIndex)return t();let n=this.canvas.getContext("2d");if(!n)return s(new Error("Cannot find context to paint on"));let l,r,d=0,c=0,o=e.height/e.width;this.canvas.height/this.canvas.width>o?(l=this.canvas.height/o,r=this.canvas.height,d=(this.canvas.width-l)/2):(l=this.canvas.width,r=this.canvas.width*o,c=(this.canvas.height-r)/2),window.requestAnimationFrame(()=>{n.clearRect(0,0,this.canvas.width,this.canvas.height),n.drawImage(e,0,0,e.width,e.height,d,c,l,r),this.lastDrawnFrameIndex=a,t()})})}startEasingSequence(e){clearInterval(this.easingSequenceId);let a=this.lastDrawnFrameIndex||0;return new Promise(t=>{let s=Date.now(),n=s-this.lastEasingCallTime,l=Math.abs(this.lastTargetIndex-e)/n,r=Math.round(l/n*this.imageLoader.getNumberOfImages()*2),d=Math.min(Math.round(this.imageLoader.getNumberOfImages()*.05),N,this.easingType===0?r:Math.ceil(I/n));this.lastEasingCallTime=s,this.lastTargetIndex=e;let c=e-a,o=e-Math.sign(c)*Math.min(d,Math.abs(e-a)),h=e-o,g=s,p=g+I;this.drawImageByIndex(o),this.easingSequenceId=setInterval(()=>{let v=Date.now();if(v>p)return clearInterval(this.easingSequenceId),this.easingSequenceId=void 0,t();let D=(v-g)/I,M=S.easeOutCubic(D),A=Math.round(h*M)+o;this.drawImageByIndex(A)},b)})}}});export{P as a,R as b,k as c,_ as d};
