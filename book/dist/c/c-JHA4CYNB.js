import{a as g}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-2TSYQWVN.js";import{d as v,e as V}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-OKZSTQSX.js";import{a as h,b as k}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SN7J37LE.js";import{h as U,x as C}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-I6RXPP7W.js";import{a as u,b as S}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-JWQSDUFI.js";import{r as $,s as y}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-42TSFLLH.js";import{b as w,c as O}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SXBIDYQQ.js";import{c as n,e as I}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-GJYOXBH4.js";import{a as L}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-3SFTLRL3.js";import{b as _}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-W2OJRSJR.js";import{d as x}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TZYDFHR2.js";var r=x(L()),l=x(_());y();O();S();k();V();C();I();var M=g.extend({antialiasRotation:!0,render:function(){this.makeBox("widget-picture"),n("widget.fixMobileImageStretch")&&this.el?.classList.add("fixMobileImageStretch"),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isLightboxEnabled()&&this.initLightbox(),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.$lqipImg=null,this.useLqip=!h.isDownloadedSource&&this.mag?.viewOpts?.lqip&&!!this.blurHash&&(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture));let i=this.getPictureUrl();if(/\.gif/.test(i)&&(this.isGIF=!0),this.$el.html(""),this.isVector(i)&&!w.IS_FILE_PROTOCOL)this.loadVector(i);else{let e=!!(this.border_size>0||this.border_radius>0||this.border_radius_max||this.border_radius_independent&&(this.border_radius_tl>0||this.border_radius_tr>0||this.border_radius_bl>0||this.border_radius_br>0)||this.is_full_width||this.is_full_height),t=this.opacity===void 0?1:this.opacity;if(this.insideHotspot&&this.isGIF){let s=this.scale;(0,r.default)("<div/>").appendTo(this.$el).css({position:"absolute","background-image":"url("+i+")","background-position":"50% 50%",width:Math.max(Math.round(this.originalW*s),this.w),height:Math.max(Math.round(this.originalH*s),this.h),top:-Math.round(this.cropY*s),left:-Math.round(this.cropX*s)}).attr("url",i)}else if(e){let s=U(this.border_color||"000000",typeof this.border_color_opacity>"u"?1:this.border_color_opacity/100),o=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`;(0,r.default)("<div/>").appendTo(this.$el).addClass("bgpic").css({"background-image":this.useLqip?"":`url(${i})`,"background-position":`${this.fhpos?this.fhpos:50}% ${this.fwpos?this.fwpos:50}%`,"box-shadow":this.border_size>0?`inset 0 0 0 ${this.border_size}px ${o}`:"none","border-radius":this.getBorderRadius(),opacity:this.useLqip?0:t}).attr("url",this.useLqip?"":i)}if(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture)){let s=h.getSrcset(this.picture,{...this.getPictureOptions()});(0,r.default)("<img/>").attr("srcset",s).attr("alt",this.getAltText()).attr("src",i).addClass("viewable").toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("opacity",0).load(l.default.bind(function(){let o=this.$el.find(".viewable"),p=o&&o.get(0)&&o.get(0).currentSrc||i,a=this.$el.find(".bgpic");a&&a.css({opacity:t,"background-image":`url(${p})`}).attr("url",p),o&&o.css("opacity",t),this.$lqipImg&&this.$lqipImg.css("opacity",0),l.default.delay(l.default.bind(function(){this.$el.css({overflow:"","border-radius":""}),this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()},this),200)},this)).on("error",l.default.bind(function(){this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()},this)).appendTo(this.$el),this.useLqip&&(this.$el.css("overflow","hidden"),(this.border_radius||this.border_radius_max||this.border_radius_independent)&&this.$el.css("border-radius",this.getBorderRadius()),this.$lqipImg=(0,r.default)("<div/>").addClass("lqip").css({"background-image":`url("${this.blurHash?h.decodeBlurHash(this.blurHash,this.w,this.h):h.getLqipUrl(this.picture,{cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH})}")`,"background-position":"50% 50%",opacity:t}).appendTo(this.$el))}else(0,r.default)("<img/>").appendTo(this.$el).toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("object-fit",this.isGIF?"cover":"fill").css("opacity",typeof this.opacity>"u"?1:this.opacity).addClass("viewable").load(l.default.bind(function(){this.$el.find("img").attr("url",i),this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded).attr("srcset",this.getSrcset()).attr("alt",this.getAltText()).attr("src",i)}return this.checkLink(),this},getBorderRadius:function(){return this.border_radius_independent?`${this.border_radius_tl||0}px ${this.border_radius_tr||0}px ${this.border_radius_br||0}px ${this.border_radius_bl||0}px`:`${this.border_radius_max?"9999":this.border_radius||0}px`},isLightboxEnabled:function(){let i=!!this.getAnimations().find(t=>t.type==="click"&&t.steps&&t.steps.length),e=!!this.clickLink;return this.lightbox?this.lightbox.enabled&&!i&&!e:this.preview_enabled&&!i&&!e},isValid:function(){return!!(this.picture&&(this.picture.type||this.picture.unscaledUrl||this.picture.finalUrl||this.picture.editedVectorUrl||this.picture.url))},isVector:function(i,e){let t=i||this.picture&&this.picture.url;return(e||this.picture&&this.picture.type)==="svg"?!0:t&&l.default.last(t.split(".")).indexOf("svg")===0},start:function(){return g.prototype.start.call(this),Modernizr.safari&&this.isGIF&&this.$el.flashClass("fix-safari-gif",100),this},getPictureOptions:function(){let i=this.getAnimations().reduce((e,t)=>Math.max(e,v.maxScaleAnimation(t)),0);return{width:this.w,height:this.h,cropX:n("widget.fixMobileImageStretch")?this.cropX??this.originalCropX:this.cropX,cropY:n("widget.fixMobileImageStretch")?this.cropY??this.originalCropY:this.cropY,cropW:n("widget.fixMobileImageStretch")?this.cropW??this.originalCropW:this.cropW,cropH:n("widget.fixMobileImageStretch")?this.cropH??this.originalCropH:this.cropH,originalW:this.originalW,originalH:this.originalH,scale:u.isScaleLayout(this.mag.viewOpts)?this.page.scale:1,animationScale:i&&i/100,isStretched:this.is_full_width||this.is_full_height}},getPictureUrl:function(){if(!this.picture)return"";if(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture))return h.getLambdaUrl(this.picture,this.getPictureOptions());if(this.picture.finalUrl&&l.default.last(this.picture.finalUrl.split(".")).indexOf("svg")===0)return this.picture.finalUrl;let i;return u.isOnForRatio(this.page.pageViewport,this.page.scale,this.mag.viewOpts)?i=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl:Modernizr.retina?i=(window.devicePixelRatio>=3?this.picture.final3xUrl||this.picture.unscaledOptimizedUrl||this.picture.final2xUrl:this.picture.final2xUrl)||this.picture.unscaledOptimizedUrl||this.picture.finalUrl:i=this.picture.finalUrl,(this.is_full_width||this.is_full_height)&&(i=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl),i||this.picture.effectUrl||this.picture.editedVectorUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.url},getAltText:function(){return this.picture&&this.alt?l.default.escape(this.alt):void 0},getSrcset:function(i=!0){if(!this.picture)return[];if(!this.originalW)return[];if(this.isGIF)return[];if(u.isOn(this.page.pageViewport,this.mag.getViewportWidth(this.page.pageViewport),this.mag.viewOpts))return[];if(this.getAnimations().length)return[];if(RM.screenshot)return[];if(this.picture.finalUrl&&l.default.last(this.picture.finalUrl.split(".")).indexOf("svg")===0)return[];let e=Math.floor(this.w),t=[{url:this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl,size:this.originalW},{url:this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl),size:e*3},{url:this.picture.final2xUrl,size:e*2},{url:this.picture.finalUrl,size:e}];if(t=t.filter(function(o){return!!o.url&&this.originalW>=o.size}.bind(this)).map(function(o){return`${o.url} ${o.size}w`}),!i)return t;let s=[`${this.picture.finalUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl} 1x`];return this.picture.final2xUrl&&s.push(`${this.picture.final2xUrl} 2x`),this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)&&s.push(`${this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)} 3x`),s.concat(t)},loadVector:function(i){this.$el.addClass("svg"),this.svgAjax=r.default.get(i+"?c",l.default.bind(function(e){let t=(0,r.default)($.cleanupSVG((0,r.default)(e).find("svg").get(0).cloneNode(!0))),s=t.get(0).getAttribute("viewBox");t.get(0).removeAttribute("width"),t.get(0).removeAttribute("height"),this.$svg=t;let o=t.get(0).cloneNode(!0);this.$svg.find("title").remove();let a=new Image;(0,r.default)(a).on("load error",l.default.bind(function(){(0,r.default)(a).appendTo(window.document.body).css({width:"100%",height:"100%"});let f=this.flags?.useOriginalViewBoxSVG,c=(0,r.default)(o);f&&s||c.get(0).setAttribute("viewBox","0 0 "+(0,r.default)(a).width()+" "+(0,r.default)(a).height()),c.appendTo(window.document.body);let d=c.get(0).getBBox();f&&s||this.$svg.get(0).setAttribute("viewBox",d.x+" "+d.y+" "+d.width+" "+d.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),this.$svg.get(0).setAttribute("role","img");let b=this.getAltText();b&&this.$svg.get(0).setAttribute("aria-label",b),(0,r.default)(a).remove(),c.remove();let m=(0,r.default)('<div class="svg-scale-wrapper"></div>');this.$svg.appendTo(m),m.appendTo(this.$el),this.widgetIsLoaded()},this)),a.src=i},this)).fail(this.widgetIsLoaded)},initLightbox:async function(){this.lightbox&&(this.$el.on("click",()=>{this.page.showLightboxSlide(this)}),this.$el.addClass("preview-enabled"))},checkLightboxVisibility:function(i){if(i&&(this?.page?.lightboxModel?.get("isVisible")||!1)){let t=this?.page?.lightboxModel?.get("onClose");t&&typeof t=="function"&&t()}},onMagViewportBeforeChange:function(i){let e=i?.viewport;this.checkLightboxVisibility(e)}}),G=M;export{G as a};
