import{a as E,b as ee}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-THKPLK5P.js";import{d as D,h as J}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-VUD7OPNE.js";import{b as p,c as K}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-SXBIDYQQ.js";import{a as I}from"https://st-p.rmcdn1.net/e0cde9ba/dist/c/c-TZYDFHR2.js";var z,H,S,w,P,te,_,O,re,ae,le,oe,F,j,ne,se,ie,ce,G,V=I(()=>{"use strict";z=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],H=e=>{let t=0;for(let r=0;r<e.length;r++){let a=e[r],o=z.indexOf(a);t=t*83+o}return t},S=(e,t)=>{var r="";for(let a=1;a<=t;a++){let o=Math.floor(e)/Math.pow(83,t-a)%83;r+=z[Math.floor(o)]}return r},w=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},P=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},te=e=>e<0?-1:1,_=(e,t)=>te(e)*Math.pow(Math.abs(e),t),O=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},re=e=>{if(!e||e.length<6)throw new O("The blurhash string must be at least 6 characters");let t=H(e[0]),r=Math.floor(t/9)+1,a=t%9+1;if(e.length!==4+2*a*r)throw new O(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*a*r}`)},ae=e=>{let t=e>>16,r=e>>8&255,a=e&255;return[w(t),w(r),w(a)]},le=(e,t)=>{let r=Math.floor(e/361),a=Math.floor(e/19)%19,o=e%19;return[_((r-9)/9,2)*t,_((a-9)/9,2)*t,_((o-9)/9,2)*t]},oe=(e,t,r,a)=>{re(e),a=a|1;let o=H(e[0]),s=Math.floor(o/9)+1,i=o%9+1,d=(H(e[1])+1)/166,c=new Array(i*s);for(let l=0;l<c.length;l++)if(l===0){let n=H(e.substring(2,6));c[l]=ae(n)}else{let n=H(e.substring(4+l*2,6+l*2));c[l]=le(n,d*a)}let f=t*4,u=new Uint8ClampedArray(f*r);for(let l=0;l<r;l++)for(let n=0;n<t;n++){let m=0,U=0,y=0;for(let b=0;b<s;b++)for(let g=0;g<i;g++){let h=Math.cos(Math.PI*n*g/t)*Math.cos(Math.PI*l*b/r),M=c[g+b*i];m+=M[0]*h,U+=M[1]*h,y+=M[2]*h}let L=P(m),$=P(U),B=P(y);u[4*n+0+l*f]=L,u[4*n+1+l*f]=$,u[4*n+2+l*f]=B,u[4*n+3+l*f]=255}return u},F=oe,j=4,ne=(e,t,r,a)=>{let o=0,s=0,i=0,d=t*j;for(let f=0;f<t;f++){let u=j*f;for(let l=0;l<r;l++){let n=u+l*d,m=a(f,l);o+=m*w(e[n]),s+=m*w(e[n+1]),i+=m*w(e[n+2])}}let c=1/(t*r);return[o*c,s*c,i*c]},se=e=>{let t=P(e[0]),r=P(e[1]),a=P(e[2]);return(t<<16)+(r<<8)+a},ie=(e,t)=>{let r=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[0]/t,.5)*9+9.5)))),a=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[1]/t,.5)*9+9.5)))),o=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[2]/t,.5)*9+9.5))));return r*19*19+a*19+o},ce=(e,t,r,a,o)=>{if(a<1||a>9||o<1||o>9)throw new O("BlurHash must have between 1 and 9 components");if(t*r*4!==e.length)throw new O("Width and height must match the pixels array");let s=[];for(let l=0;l<o;l++)for(let n=0;n<a;n++){let m=n==0&&l==0?1:2,U=ne(e,t,r,(y,L)=>m*Math.cos(Math.PI*n*y/t)*Math.cos(Math.PI*l*L/r));s.push(U)}let i=s[0],d=s.slice(1),c="",f=a-1+(o-1)*9;c+=S(f,1);let u;if(d.length>0){let l=Math.max(...d.map(m=>Math.max(...m))),n=Math.floor(Math.max(0,Math.min(82,Math.floor(l*166-.5))));u=(n+1)/166,c+=S(n,1)}else u=1,c+=S(0,1);return c+=S(se(i),4),d.forEach(l=>{c+=S(ie(l,u),2)}),c},G=ce});function Y(e,t,r){let a=e*4+1,o=6+t*(5+a),s=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,o>>>24,o>>16&255,o>>8&255,o&255,73,68,65,84,120,1],i=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],d=1,c=0;for(let f=0,u=0,l=a-1;f<t;f++,l+=a-1)for(s.push(f+1<t?0:1,a&255,a>>8,~a&255,a>>8^255,0),c=(c+d)%65521;u<l;u++){let n=r[u]&255;s.push(n),d=(d+n)%65521,c=(c+d)%65521}s.push(c>>8,c&255,d>>8,d&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[f,u]of[[12,29],[37,41+o]]){let l=-1;for(let n=f;n<u;n++)l^=s[n],l=l>>>4^i[l&15],l=l>>>4^i[l&15];l=~l,s[u++]=l>>>24,s[u++]=l>>16&255,s[u++]=l>>8&255,s[u++]=l&255}return"data:image/png;base64,"+btoa(String.fromCharCode(...s))}var Q=I(()=>{"use strict"});function he(e,t={}){let{dprSet:r=[2,3],...a}=t,o=[];if((r||[]).forEach(i=>{a.dpr=i;let d=A(e,a);d!==o[o.length-1]?.url&&o.push({dpr:i,url:d})}),t.asArray)return o;let s=o.map(i=>`${i.url} ${i.dpr}x`);return s.length>1?s.join(", "):void 0}function N(e){return Math.floor(Math.log10(e)*10)}function Me(e,t){if(t)return t==="svg";if(e){let r=e.split(".");return r[r.length-1].indexOf("svg")===0}return!1}var ue,q,v,W,X,de,k,fe,Z,A,me,pe,ge,T,be,qe,xe=I(()=>{"use strict";J();K();ee();V();Q();ue=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.homepageRewrite),q=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.isDownloadedSource)&&!ue,v=e=>p.allowedLambdaExt.includes(e),W=e=>!!(!q&&e&&e.lambdaUrl&&v(e.type)),X=(e,t)=>{switch(t){case"video":case"slideshow":return!!(!q&&e&&e.url&&v(e.type));case"background":return!!(!q&&e&&(e.url||e.finalUrl)&&v(e.type));default:return!!(!q&&e&&(e.unscaledUrl||e.unscaledOptimizedUrl)&&v(e.type))}},de=e=>!!(e&&e.lqipUrl||W(e)),k=(e={})=>{let{width:t,height:r,cropX:a,cropY:o,cropW:s,cropH:i,originalW:d=9999,originalH:c=9999,quality:f,ext:u,scale:l,animationScale:n,isStretched:m,dpr:U,lossless:y,nearLossless:L,fit:$="none",useLargerPictureSizeForBetterQuality:B=!1}=e,b=typeof window<"u"&&window.devicePixelRatio||p.minDpr,g=U||(b<p.minDpr?p.minDpr:b),h=[],M=Math.max(l||1,1),R=n||1;if(!m&&t){let x=B&&r?Math.max(t,r):t,C=Math.min(Math.round(x*g*M*R),d);C<d&&h.push(`w=${C}`)}if(!m&&!t&&r){let x=Math.min(Math.round(r*g*M*R),c);x<c&&h.push(`h=${x}`)}if(f&&h.push(`q=${f}`),u&&h.push(`e=${u}`),y&&h.push("ll=true"),L&&h.push("nll=true"),$==="auto"&&t&&r){let x=Math.min(Math.round(r*g*M*R),c);x<c&&h.push(`h=${x}`)}return a!==void 0&&o!==void 0&&s&&i&&(s!==d||i!==c)&&(h.push(`cX=${a}`),h.push(`cY=${o}`),h.push(`cW=${s}`),h.push(`cH=${i}`)),h.length?`?${h.join("&")}`:""},fe=(e,t)=>{if(!e)return"";try{let r=new URL(t.useOriginalUrlForOldWidget?e.url||e.unscaledUrl||e.unscaledOptimizedUrl||e.finalUrl||"":e.unscaledUrl||e.url||e.unscaledOptimizedUrl||e.finalUrl||"");return`${p.readymag_lambda_host}${r.pathname}`}catch{return""}},Z=(e,t)=>e?`${e.lambdaUrl||fe(e,t)}`:"",A=(e,t={},r={})=>{if(!e)return"";let a={...t};return!r.useOriginalUrlForOldWidget&&X(e)&&!W(e)&&(a.cropX=void 0,a.cropY=void 0,a.cropW=t.originalW,a.cropH=t.originalH),E.isSupported("webp")&&(a.ext="webp",e.type==="png"&&(a.nearLossless=!0)),`${Z(e,r)}${k(a)}`};me=(e,t={})=>{if(!e)return"";if(e.lqipUrl)return e.lqipUrl;let r={dpr:1,width:p.lqipWidth,quality:p.lqipQuality,...t};return A(e,r)},pe=(e,t={})=>{if(!e)return"";let r={width:p.THUMB_SIZE,height:p.THUMB_SIZE,quality:p.THUMB_QUALITY,fit:"auto",...t};return A(e,r)},ge=async e=>{let t=new Image;t.crossOrigin="Anonymous",t.src=e,await t.decode();let r=N(t.width),a=Math.floor(t.height*(r/t.width)),o=D.createElement("canvas");o.width=r,o.height=a;let s=o.getContext("2d");s?.drawImage(t,0,0,r,a);let i=s?.getImageData(0,0,r,a);return i?G(i.data,i.width,i.height,4,4):""},T=new Map,be=(e,t,r)=>{let a=N(t),o=Math.floor(r*(a/t)),s=F(e,a,o);if(T.has(e))return T.get(e);let i=Y(a,o,s);return T.set(e,i),i};qe={isDownloadedSource:q,isVector:Me,allowedLambdaExt:v,useLambdaUrl:W,useLambdaUrlOldProjects:X,useLqipUrl:de,getLambdaUrl:A,getOriginalLambdaUrl:Z,getLambdaParams:k,getSrcset:he,getLqipUrl:me,getThumbnailUrl:pe,encodeBlurHash:ge,decodeBlurHash:be}});export{qe as a,xe as b};
